<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    
    <title>Métodos numéricos para solução de equações não lineares - Teaching Assistant</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../../css/base.min.css" rel="stylesheet">
    <link href="../../../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="../../..">Teaching Assistant</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../alglin/info/">Álgebra Linear</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../info/">Análise Numérica</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../curvas/info/">Curvas</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../edo/info/">EDO</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../edp/info/">EDP</a>
                    </li>
                
                
                
                    <li >
                        <a href="../../../infestatistica/info/">Estatística</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://lucasmoschen.github.io">Página Inicial</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#metodos-numericos-para-solucao-de-equacoes-nao-lineares">Métodos numéricos para solução de equações não lineares</a></li>
            <li class="second-level"><a href="#iteracao-de-ponto-fixo">Iteração de Ponto Fixo</a></li>
                
            <li class="second-level"><a href="#metodo-de-newton">Método de Newton</a></li>
                
                <li class="third-level"><a href="#exemplo-adicional">Exemplo adicional</a></li>
                <li class="third-level"><a href="#um-outro-exemplo">Um outro exemplo</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="metodos-numericos-para-solucao-de-equacoes-nao-lineares">Métodos numéricos para solução de equações não lineares</h1>
<p>Escrevemos no <a href="/ta-sessions/analisenum/non_linear_equations">parte anterior</a> o resumo dos algoritmos de alguns métodos para solução de equações não lineares, e não são os únicos. Modificações desses métodos, em especial do Método de Newton são constantemente sugeridas para melhorar a
convergência. Fica claro que muitos sistemas no mundo real são não lineares. Uma aplicação comum é resolver problemas de otimização. Por exemplo, quando queremos maximizar em conjuntos abertos, se conseguirmos provar algumas condições, podemos assegurar que o máximo se encontra quando <script type="math/tex">f'(x) = 0</script>. Logo, o problema de otimização se resume a um problema de encontrar raízes. </p>
<pre class="highlight"><code class="language-python">import numpy as np
import scipy.special as scis
import scipy.optimize as scop
import matplotlib.pyplot as plt

%matplotlib inline</code></pre>
<p>Um jogador A ganha com placar (21-0) do jogador B em um jogo de <a href="https://pt.wikipedia.org/wiki/Raquetebol">raquetebol</a> com <a href="https://dokumen.tips/documents/probability-of-a-shutout-in-racquetball-58dea76bc2677.html">probabilidade</a>. </p>
<p>
<script type="math/tex; mode=display">
P = \frac{p+1}{2}\left(\frac{p}{1-p+p^2}\right)^{21},
</script>
</p>
<p>em que <script type="math/tex">p</script> é a probabilidade de <script type="math/tex">A</script> ganhar um rally qualquer. Qual o valor de <script type="math/tex">p</script> que assegura que <script type="math/tex">A</script> vencerá com esse placar em pelo menos metade dos jogos? Esse é um problema real proposto por Ralph Levine para Joseph Keller.</p>
<pre class="highlight"><code class="language-python">def P(p):
    return (p+1)/2 * (p/(1 + p**2-p))**(21)</code></pre>
<pre class="highlight"><code class="language-python">p_values = np.linspace(0, 1, 50)
P_values = P(p_values)
plt.plot(p_values, P_values, color='r')
plt.axhline(0.5, linestyle = '--', color = 'darkblue')
plt.title('Probabilidade de 21-0 para cada p')
plt.text(0.7, 0.55, '$P = 0.5$', fontsize=12)
plt.xlabel('$p$')
plt.ylabel('$P$')
plt.show()</code></pre>
<p><img alt="png" src="../output_4_0.png" /></p>
<p>Vamos explorar métodos de resolver a equação <script type="math/tex">P(p) = 0.5</script> para <script type="math/tex">p</script>, isto é, <script type="math/tex">P(p) - 0.5 = 0</script>, através do método do Ponto Fixo e do Método de Newton.  </p>
<h2 id="iteracao-de-ponto-fixo">Iteração de Ponto Fixo</h2>
<p>Temos que </p>
<p>
<script type="math/tex; mode=display">
f(p) = 0.5 - \frac{p+1}{2}\left(\frac{p}{1-p+p^2}\right)^{21} + p = p,
</script>
</p>
<p>é a função que admite o ponto fixo que queremos. Um ponto importante seria provar as condições de funcionamento do método. Porém, não é difícil ver que <script type="math/tex">f([0,1]) \not \subseteq [0,1]</script>, o que já quebra nosso teorema.</p>
<pre class="highlight"><code class="language-python">def f(p): 
    return 0.5 - P(p) + p

def fixed_point(x0, tol = 1e-5, max_ite = 1e4): 

    x1 = f(x0)
    err = [abs(x1 - x0)]
    sols = [x0, x1]

    while err[-1] &gt; tol and len(err) &lt;= max_ite: 

        sols.append(f(sols[-1]))
        err.append(abs(sols[-1] - sols[-2]))

    return {'sol': sols, 'errors': err}

print(f(0.7))</code></pre>
<pre><code>1.1329638832103943
</code></pre>
<p>Bom, mas vamos supor que mesmo assim quiséssemos usar esse método.</p>
<pre class="highlight"><code class="language-python">res = fixed_point(0.7)
plt.scatter(range(len(res['sol'])), res['sol'])</code></pre>
<pre><code>&lt;matplotlib.collections.PathCollection at 0x7f6a17b5eb38&gt;
</code></pre>
<p><img alt="png" src="../output_8_1.png" /></p>
<p>Ele não converge! Mas a gente já devia ter ficado desconfiado, pois justamente as condições do Teorema não functionavam. Em particular, é fácil ver que ele não é nem não expansivo. Usando Scipy:</p>
<pre class="highlight"><code class="language-python">scop.fixed_point(func = f, x0 = 0.81, method = 'iteration')</code></pre>
<pre><code>---------------------------------------------------------------------------

RuntimeError                              Traceback (most recent call last)

&lt;ipython-input-6-93ff8160efab&gt; in &lt;module&gt;
----&gt; 1 scop.fixed_point(func = f, x0 = 0.81, method = 'iteration')


~/anaconda3/lib/python3.7/site-packages/scipy/optimize/minpack.py in fixed_point(func, x0, args, xtol, maxiter, method)
    935     use_accel = {'del2': True, 'iteration': False}[method]
    936     x0 = _asarray_validated(x0, as_inexact=True)
--&gt; 937     return _fixed_point_helper(func, x0, args, xtol, maxiter, use_accel)


~/anaconda3/lib/python3.7/site-packages/scipy/optimize/minpack.py in _fixed_point_helper(func, x0, args, xtol, maxiter, use_accel)
    889         p0 = p
    890     msg = "Failed to converge after %d iterations, value is %s" % (maxiter, p)
--&gt; 891     raise RuntimeError(msg)
    892 
    893


RuntimeError: Failed to converge after 500 iterations, value is 0.4998542288112865
</code></pre>
<p>Existe uma variação desse dado pelo método Steffensen com Aitken's <script type="math/tex">\Delta^2</script>, que constrói uma sequência com onvergência mais rápida, a partir da inicial. </p>
<pre class="highlight"><code class="language-python">%timeit scop.fixed_point(func = f, x0 = 0.3, method = 'del2')</code></pre>
<pre><code>1.08 ms ± 120 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<pre class="highlight"><code class="language-python">scop.fixed_point(func = f, x0 = 0.3, method = 'del2')</code></pre>
<pre><code>array(0.84230479)
</code></pre>
<pre class="highlight"><code class="language-python">%timeit scop.fixed_point(func = f, x0 = 0.8, method = 'del2')</code></pre>
<pre><code>1.21 ms ± 165 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<pre class="highlight"><code class="language-python">scop.fixed_point(func = f, x0 = 0.8, method = 'del2')</code></pre>
<pre><code>array(0.84230479)
</code></pre>
<p>Olhe o que acontece com <script type="math/tex">x_0 = 0.1</script>. </p>
<pre class="highlight"><code class="language-python">scop.fixed_point(func = f, x0 = 0.1, method = 'del2')</code></pre>
<pre><code>array(-3.51843721e+13)
</code></pre>
<h2 id="metodo-de-newton">Método de Newton</h2>
<p>Agora vamos usar informação da derivada de <script type="math/tex">P</script> para nos ajudar com o problema de encontrar a raíz de <script type="math/tex">P(p) - 0.5 = 0</script>. Note que <script type="math/tex">P(0) < 0.5</script> e <script type="math/tex">P(1) > 0.5</script>. }Para nos ajudar com as contas, vamos considerar a versão com log, isto é, <script type="math/tex">\log(P(p)) = - \log(2)</script>. Assim, </p>
<p>
<script type="math/tex; mode=display"> 
\log(p+1) - \log(2) + 21(\log(p) - \log(1 - p + p^2)) = -\log(2), 
</script>
</p>
<p>o que simplica para <script type="math/tex">g(p) = \log(p+1) + 21(\log(p) - \log(1 - p + p^2)) = 0</script>. Aí temos que </p>
<p>
<script type="math/tex; mode=display">
g'(p) = \frac{1}{p+1} + \frac{21}{p} - \frac{21}{1 - p + p^2}(2p - 1)
</script>
</p>
<pre class="highlight"><code class="language-python">def g(p): 
    return np.log(p+1) + 21*(np.log(p) - np.log1p(p**2 - p))

def g_prime(p): 
    return 1 / (p+1) + 21 / p - 21 * (2*p - 1) / (1 - p + p**2)</code></pre>
<p>Podemos provar analiticamente que a derivada é estritamente positiva, mas faremos a observação numérica através do seguinte gráfico. </p>
<pre class="highlight"><code class="language-python">g_values = g_prime(p_values[1:])
plt.plot(p_values[1:], g_values, color='r')
plt.title('Derivada da função derivada')
plt.xlabel('$p$')
plt.ylabel("$g\'(p)$")
plt.show()</code></pre>
<p><img alt="png" src="../output_21_0.png" /></p>
<p>Aplicando o método de newton através do Scipy. Observe que o seu tempo deu bem menor que o anterior, mesmo com um valor de <script type="math/tex">x_0</script> bem distante. </p>
<pre class="highlight"><code class="language-python">%timeit scop.newton(func = g, x0 = 0.1, fprime = g_prime)</code></pre>
<pre><code>836 µs ± 117 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<pre class="highlight"><code class="language-python">scop.newton(func = g, x0 = 0.1, fprime = g_prime)</code></pre>
<pre><code>0.8423047910355657
</code></pre>
<p>Observe o método da Secante, um método que também usa a ideia de tangente, mas sem consultar a derivada. </p>
<pre class="highlight"><code class="language-python">%timeit scop.newton(func = g, x0 = 0.1)</code></pre>
<pre><code>631 µs ± 111 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</code></pre>
<pre class="highlight"><code class="language-python">scop.newton(func = g, x0 = 0.1)</code></pre>
<pre><code>0.8423047910355633
</code></pre>
<h3 id="exemplo-adicional">Exemplo adicional</h3>
<p>Nesse exemplo, a ideia é verificar que Newton pode dar errado. Considere: </p>
<p>
<script type="math/tex; mode=display">
f(x) = x\sin(\pi x) - \exp(-x)
</script>
</p>
<pre class="highlight"><code class="language-python">f = lambda x: x * np.sin(np.pi * x) - np.exp(-x)</code></pre>
<pre class="highlight"><code class="language-python">x = np.linspace(-1, 2, 100)
y = f(x)

fig, ax = plt.subplots()
ax.plot(x, y, color='r',zorder=0)
xs = [0.57, 0.83, -0.27]
texts = ['raiz$_1$', 'raiz$_2$', 'mínimo local']
for i in range(len(xs)):
    ax.scatter([xs[i]], [f(xs[i])],marker='x',s=60)
    ax.text(xs[i]+0.05, f(xs[i])-0.1, texts[i])
ax.plot(x,np.zeros_like(x),color='gray',ls='-.',alpha=0.75)
ax.set_xlabel('$x$')
ax.set_ylabel('$f(x)$')
plt.title('$f(x)= x sin(\pi x) - exp(-x)$')
plt.show()</code></pre>
<p><img alt="png" src="../output_30_0.png" /></p>
<pre class="highlight"><code class="language-python">xspace = np.linspace(-0.7, 0.7, 15)

for x in xspace:
    print('Com x_0 = {0:5.2f}, a raíz é {1:5.2f}'.format(x, scop.newton(f,x)))</code></pre>
<pre><code>Com x_0 = -0.70, a raíz é  2.02
Com x_0 = -0.60, a raíz é  0.58
Com x_0 = -0.50, a raíz é  1.27
Com x_0 = -0.40, a raíz é  0.82
Com x_0 = -0.30, a raíz é -0.30
Com x_0 = -0.20, a raíz é  0.82
Com x_0 = -0.10, a raíz é  2.02
Com x_0 =  0.00, a raíz é  0.82
Com x_0 =  0.10, a raíz é  0.58
Com x_0 =  0.20, a raíz é  0.58
Com x_0 =  0.30, a raíz é  0.58
Com x_0 =  0.40, a raíz é  0.58
Com x_0 =  0.50, a raíz é  0.58
Com x_0 =  0.60, a raíz é  0.58
Com x_0 =  0.70, a raíz é  0.58
</code></pre>
<h3 id="um-outro-exemplo">Um outro exemplo</h3>
<p>Vamos comparar os métodos agora com a função <script type="math/tex">f(x) = x - \cos(x)</script>. Para o
método do ponto fixo, vamos utilizar a função <script type="math/tex">g(x) = \cos(x)</script>, naturalmente.
Note que <script type="math/tex">g([0,1]) \subseteq [0,1]</script> e <script type="math/tex">|g'([0,1])| \subseteq [0,0.9]</script>, isto é,
temos que as hipóteses para a iteração do ponto fixo são válidas. </p>
<pre class="highlight"><code class="language-python">def f(x, info):
    res = x - np.cos(x)
    if info['print']: 
        info['iter_x'].append(x)
        info['iter_res'].append(res)
    return res

def g(x, info):
    res = np.cos(x)
    if info['print']: 
        info['iter_x'].append(x)
        info['iter_res'].append(res)
    return res</code></pre>
<pre class="highlight"><code class="language-python">x = np.linspace(0, 1, 100)
y = f(x, {'iter_x': [], 'iter_res': [], 'print': False})

fig, ax = plt.subplots()
ax.plot(x, y, color='r', zorder=0)
ax.axhline(0, color = 'k', linestyle = '-.')
ax.set_title('$f(x)= x - cos(x)$')
plt.show()</code></pre>
<p><img alt="png" src="../output_34_0.png" /></p>
<pre class="highlight"><code class="language-python">info_newton = {'iter_x': [], 'iter_res': [], 'print': True}
info_secant = {'iter_x': [], 'iter_res': [], 'print': True}
info_bisect = {'iter_x': [], 'iter_res': [], 'print': True}
info_fixed = {'iter_x': [], 'iter_res': [], 'print': True}

newton = scop.newton(func = f, 
                     x0 = 0.5, 
                     fprime = lambda x, info: 1 + np.sin(x), 
                     tol = 1e-10, 
                     maxiter = 200, 
                     args = (info_newton,))

secant = scop.newton(func = f, 
                     x0 = 0.5, 
                     tol = 1e-10, 
                     maxiter = 200, 
                     args = (info_secant,))

bisect = scop.bisect(f = f, 
                     a = 0,
                     b = 1,
                     xtol = 1e-10, 
                     maxiter = 200, 
                     args = (info_bisect,))

fixed_point = scop.fixed_point(func = g, 
                               x0 =0.5, 
                               xtol = 1e-10, 
                               bisectmethod = 'iteration', 
                               maxiter = 200, 
                               args = (info_fixed,))</code></pre>
<pre class="highlight"><code class="language-python">plt.plot(info_bisect['iter_x'], label = 'bisect: {}'.format(len(info_bisect['iter_x'])))
plt.plot(info_newton['iter_x'], label = 'newton: {}'.format(len(info_newton['iter_x'])))
plt.plot(np.array(info_fixed['iter_x']), label = 'fixed point: {}'.format(len(info_fixed['iter_x'])))
plt.plot(info_secant['iter_x'], label = 'secant: {}'.format(len(info_secant['iter_x'])))
plt.legend()
plt.title('Comparando alguns métodos')
plt.xscale('log')
plt.show()</code></pre>
<p><img alt="png" src="../output_36_0.png" /></p></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = "../../.."</script>
    
    <script src="../../../js/base.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
